// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  fullName      String
  phone         String?
  profilePicture String?
  preferences   Json?     // { language, notifications, theme }
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itineraries   Itinerary[]
  budgets       Budget[]
  reviews       Review[]
  favorites     Favorite[]

  @@map("users")
}

model Destination {
  id            String    @id @default(cuid())
  name          String    @unique
  city          String
  province      String    @default("Jawa Timur")
  category      String    // Beach, Mountain, Temple, etc.
  description   String    @db.Text
  image         String
  images        String[]  @default([])
  rating        Float      @default(0)
  priceRange    String?   // budget, moderate, luxury
  coordinates   Json      // { lat, lng }
  address       String?
  openingHours  String?
  contact       String?
  website       String?
  featured      Boolean   @default(false)
  accessibilityFeatures Json? // { wheelchairAccessible, accessibleParking, accessibleRestrooms, audioGuide, signLanguage, etc. }
  disabledFriendly Boolean @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itineraries   ItineraryDestination[]
  reviews       Review[]
  favorites     Favorite[]

  @@index([city])
  @@index([category])
  @@index([featured])
  @@index([disabledFriendly])
  @@map("destinations")
}

model Itinerary {
  id            String    @id @default(cuid())
  userId        String
  title         String
  startDate     DateTime
  endDate       DateTime
  budget        Float?
  status        String    @default("draft") // draft, planned, ongoing, completed, cancelled
  thumbnail     String?
  notes         String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  destinations  ItineraryDestination[]
  days          ItineraryDay[]
  budgetPlan    Budget?

  @@index([userId])
  @@index([status])
  @@map("itineraries")
}

model ItineraryDestination {
  id            String    @id @default(cuid())
  itineraryId   String
  destinationId String
  order         Int       @default(0)
  visitDate     DateTime?
  notes         String?   @db.Text

  itinerary     Itinerary   @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([itineraryId, destinationId])
  @@index([itineraryId])
  @@map("itinerary_destinations")
}

model ItineraryDay {
  id            String    @id @default(cuid())
  itineraryId   String
  dayNumber     Int
  date          DateTime
  activities    Json      // Array of activities
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itinerary     Itinerary @relation(fields: [itineraryId], references: [id], onDelete: Cascade)

  @@unique([itineraryId, dayNumber])
  @@index([itineraryId])
  @@map("itinerary_days")
}

model Budget {
  id            String    @id @default(cuid())
  userId        String
  itineraryId   String?   @unique
  totalBudget   Float
  spent         Float     @default(0)
  categories    Json      // { accommodation, food, transport, activities, etc. }
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  itinerary     Itinerary? @relation(fields: [itineraryId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("budgets")
}

model Review {
  id            String    @id @default(cuid())
  userId        String
  destinationId String
  rating        Int       // 1-5
  comment       String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([userId, destinationId])
  @@index([destinationId])
  @@map("reviews")
}

model Favorite {
  id            String    @id @default(cuid())
  userId        String
  destinationId String
  createdAt     DateTime  @default(now())

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([userId, destinationId])
  @@index([userId])
  @@map("favorites")
}

