// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  fullName      String
  phone         String?
  profilePicture String?
  preferences   String?   // JSON: { language, notifications, theme }
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itineraries   Itinerary[]
  budgets       Budget[]
  reviews       Review[]
  favorites     Favorite[]
  photoGalleries PhotoGallery[]
  forumTopics   ForumTopic[]
  forumReplies  ForumReply[]
  sentMessages   Message[] @relation("MessageSender")
  receivedMessages Message[] @relation("MessageReceiver")
  notifications Notification[]

  @@map("users")
}

model Destination {
  id            String    @id @default(cuid())
  name          String    @unique
  city          String
  province      String    @default("Jawa Timur")
  category      String    // Beach, Mountain, Temple, etc.
  description   String
  image         String
  images        String?   // JSON string: JSON.stringify(["img1.jpg", "img2.jpg"])
  rating        Float?    // 1-5 stars
  priceRange    String?   // budget, moderate, luxury
  coordinates   String    // JSON: JSON.stringify({ lat, lng })
  address       String?
  openingHours  String?
  contact       String?
  website       String?
  featured      Boolean   @default(false)
  disabledFriendly Boolean @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itineraries   ItineraryDestination[]
  reviews       Review[]
  favorites     Favorite[]

  @@index([city])
  @@index([category])
  @@index([featured])
  @@index([disabledFriendly])
  @@index([rating])
  @@index([priceRange])
  @@map("destinations")
}

model Itinerary {
  id            String    @id @default(cuid())
  userId        String
  title         String
  startDate     DateTime
  endDate       DateTime
  budget        Float?
  status        String    @default("draft") // draft, planned, ongoing, completed, cancelled
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  destinations  ItineraryDestination[]
  days          ItineraryDay[]
  budgetPlan    Budget?

  @@index([userId])
  @@index([status])
  @@map("itineraries")
}

model ItineraryDestination {
  id            String    @id @default(cuid())
  itineraryId   String
  destinationId String
  order         Int       @default(0)
  visitDate     DateTime?
  notes         String?

  itinerary     Itinerary   @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([itineraryId, destinationId])
  @@index([itineraryId])
  @@map("itinerary_destinations")
}

model ItineraryDay {
  id            String    @id @default(cuid())
  itineraryId   String
  dayNumber     Int
  date          DateTime
  activities    String    // JSON array of activities
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  itinerary     Itinerary @relation(fields: [itineraryId], references: [id], onDelete: Cascade)
  blocks        ItineraryBlock[]

  @@unique([itineraryId, dayNumber])
  @@index([itineraryId])
  @@map("itinerary_days")
}

model Budget {
  id            String    @id @default(cuid())
  userId        String
  itineraryId   String?   @unique
  totalBudget   Float
  spent         Float     @default(0)
  categories    String    // JSON: { accommodation, food, transport, activities, etc. }
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  itinerary     Itinerary? @relation(fields: [itineraryId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("budgets")
}

model Review {
  id            String    @id @default(cuid())
  userId        String
  destinationId String
  rating        Int       // 1-5
  comment       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([userId, destinationId])
  @@index([destinationId])
  @@map("reviews")
}

model Favorite {
  id            String    @id @default(cuid())
  userId        String
  destinationId String
  createdAt     DateTime  @default(now())

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination   Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@unique([userId, destinationId])
  @@index([userId])
  @@map("favorites")
}

// Forum System
model ForumCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String
  icon        String?
  color       String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  topics      ForumTopic[]

  @@map("forum_categories")
}

model ForumTopic {
  id            String       @id @default(cuid())
  title         String
  slug          String       @unique
  content       String
  userId        String
  categoryId    String
  tags          String?      // JSON string: JSON.stringify(["tag1", "tag2"])
  isPinned      Boolean      @default(false)
  isLocked      Boolean      @default(false)
  views         Int          @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  category      ForumCategory @relation(fields: [categoryId], references: [id])
  replies       ForumReply[]

  @@index([userId])
  @@index([categoryId])
  @@index([isPinned])
  @@map("forum_topics")
}

model ForumReply {
  id        String     @id @default(cuid())
  content   String
  userId    String
  topicId   String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  topic     ForumTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([topicId])
  @@map("forum_replies")
}

model PhotoGallery {
  id            String        @id @default(cuid())
  userId        String
  title         String?
  images        String        // JSON array: ["img1.jpg", "img2.jpg"]
  isPublic      Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isPublic])
  @@map("photo_galleries")
}

model Message {
  id         String     @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  isRead     Boolean    @default(false)
  createdAt  DateTime   @default(now())

  sender     User       @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver   User       @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([isRead])
  @@map("messages")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String   // itinerary_reminder, weather_alert, etc.
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@map("notifications")
}

model Currency {
  id         String   @id @default(cuid())
  code       String   @unique // USD, IDR, EUR, THB, SGD, MYR, etc.
  name       String   // US Dollar, Indonesian Rupiah, etc.
  symbol     String   // $, Rp, â‚¬, etc.
  flag       String?  // country flag emoji
  rateToUSD  Float    // current exchange rate to USD
  isActive   Boolean  @default(true)
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())

  @@index([isActive])
  @@map("currencies")
}

model Transportation {
  id            String   @id @default(cuid())
  type          String   // flight, train, bus, car_rental, taxi
  provider      String   // Garuda Indonesia, Kereta Api, etc.
  route         String   // origin-destination
  schedule      String   // JSON: { departureTime, arrivalTime, duration, frequency }
  pricing       String   // JSON: { economy, business, firstClassRates }
  availability  String   // JSON: { seatsAvailable, bookedSeats }
  bookingUrl    String?
  status        String   @default("active") // active, cancelled, delayed
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([type])
  @@index([route])
  @@map("transportations")
}

model Accommodation {
  id            String    @id @default(cuid())
  name          String
  city          String
  province      String    @default("Jawa Timur")
  type          String    // hotel, hostel, villa, resort, homestay, budget-lodge
  category      String    // luxury, moderate, budget
  description   String
  image         String
  images        String?   // JSON array: ["img1.jpg", "img2.jpg"]
  rating        Float?    // 1-5 stars
  priceRange    String    // budget, moderate, luxury
  coordinates   String    // JSON: { lat, lng }
  address       String?
  phone         String?
  email         String?
  website       String?
  amenities     String    // JSON: { wifi: true, ac: true, pool: false, etc. }
  capacity      Int       @default(2) // max guests
  breakfast     Boolean   @default(false)
  checkInTime   String    @default("14:00")
  checkOutTime  String    @default("11:00")
  cancellationPolicy String?
  totalRooms    Int       @default(10)
  availability  String    // JSON: { availableRooms, bookedRooms }
  bookingUrl    String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([city])
  @@index([type])
  @@index([category])
  @@index([priceRange])
  @@index([coordinates])
  @@map("accommodations")
}

model Restaurant {
  id            String    @id @default(cuid())
  name          String
  city          String
  province      String    @default("Jawa Timur")
  category      String    // traditional, seafood, fine-dining, casual, street-food, cafe, bar
  cuisine       String    // indonesian, chinese, international, fusion, local, arab
  description   String
  image         String
  images        String?   // JSON array: ["img1.jpg", "img2.jpg"]
  rating        Float?    // 1-5 stars
  priceRange    String    // budget, moderate, luxury
  coordinates   String    // JSON: { lat, lng }
  address       String?
  phone         String?
  website       String?
  specialties   String    // JSON: ["Sate", "Rendang", "Soto"] - signature dishes
  menuItems     String    // JSON: { main: [], appetizer: [], dessert: [], drinks: [] }
  operatingHours String   // JSON: { monday: "09:00-22:00", tuesday: "09:00-22:00", etc. }
  dietaryOptions String?  // JSON: { halal: true, vegetarian: true, vegan: false, glutenFree: false }
  seatingCapacity Int     @default(50)
  reservationRequired Boolean @default(false)
  paymentMethods String?  // JSON: ["cash", "card", "digital_wallet"]
  parking       Boolean   @default(false)
  wifi          Boolean   @default(true)
  delivery      Boolean   @default(false)
  takeaway      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([city])
  @@index([category])
  @@index([cuisine])
  @@index([priceRange])
  @@index([coordinates])
  @@map("restaurants")
}

// Enhanced Itinerary Block System
model ItineraryBlock {
  id            String    @id @default(cuid())
  itineraryDayId String
  type          String    // accommodation, transportation, destination, restaurant, custom, activity
  order         Int       @default(0)
  title         String
  description   String?
  startTime     String?   // HH:MM format
  endTime       String?   // HH:MM format
  duration      Int?      // in minutes
  cost          Float?    // cost in IDR
  currency      String    @default("IDR")
  
  // Block-specific data stored as JSON
  blockData     String    // JSON with type-specific information
  
  // Relationships
  itineraryDay  ItineraryDay @relation(fields: [itineraryDayId], references: [id], onDelete: Cascade)
  accommodationId String?   // if block type is 'accommodation'
  transportationId String?  // if block type is 'transportation'
  destinationId   String?   // if block type is 'destination'
  restaurantId    String?   // if block type is 'restaurant'
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([itineraryDayId])
  @@index([type])
  @@index([order])
  @@index([startTime])
  @@map("itinerary_blocks")
}
